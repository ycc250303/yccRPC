# 重试机制

## 需求分析

* 目前如果调用失败会直接报错
* 调用失败可能是服务提供者错误，可能也只是网络不稳定等临时问题

## 设计方案

### 重试条件

* 网络等异常情况发生时触发重试

### 重试时间

* 重试时间算法
  * 固定时间重试
  * 指数退避重试
  * 随机延迟重试
  * 可变延迟重试（根据先前重试成功/失败情况，动态调整下一次重试时间）

### 停止重试

* 最大次数停止
* 超时停止

### 重试工作

* 重试操作：重复执行原本操作
* 重试失败
  * 通知告警：开发者人工介入
  * 降级容错：改为调用其他接口、或执行其他操作

## 开发实现

### 实现重试策略

* 编写重试策略接口，提供重试方法
* 引入重试库依赖
* 实现不重试策略类和固定重试间隔策略类

### 配置和扩展重试策略

* 添加重试策略常量类
* 添加重试策略工厂类，根据 key 从 SPI 获取重试策略对象实例
* 编写重试策略接口 SPI 配置文件
* 对 RPC 全局配置新增重试策略配置

### 应用重试功能

* 修改 SerivceProxy 代码，从工厂中获取充实器
