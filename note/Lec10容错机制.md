# 容错机制

## 需求分析

* 重试超过一定次数仍然失败
* 调用失败时一定要重试吗？

## 设计方案

### 容错机制

* 系统在出现异常情况时，可以通过一定的策略保证系统仍然稳定运行，从而提高系统的可靠性和健壮性。

#### 容错策略

* Fail-Over 故障转移：一次调用失败，切换其他节点调用
* Fail-Back 失败自动恢复：某个功能出现调用失败或错误时，通过其他方法恢复该功能正常。可以理解为降级，比如重试、调用其他服务等。
* Fail-Safe 静默处理：系统出现部分非重要功能的异常时，直接忽略掉，不做任何处理。
* Fail-Fast 快速失败：系统出现调用错误时，立刻报错，交给外层调用方处理。

#### 容错实现方式

* 重试：本质上也是容错的降级策略，系统错误后再试一次。
* 限流：当系统压力过大、已经出现部分错误时，通过限制执行操作（接受请求）的频率或数量，对系统进行保护。
* 降级：系统出现错误后，改为执行其他更稳定可用的操作。这种方式的本质是：即使牺牲一定的服务质量，也要保证系统的部分功能可用，保证基本的功能需求得到满足。
* 熔断：系统出现故障或异常时，暂时中断对该服务的请求，执行其他操作，以避免连锁故障。
* 超时控制：如果请求或操作长时间没处理完成，就进行中断，防止阻塞和资源占用。

### 容错方案设计

* 先容错再重试
* 先重试再容错

## 开发实现

### 实现容错策略

* 新建容错策略接口 `TolerantStrategy`，定义容错策略方法
* 实现四种容错策略类

### 配置和扩展容错策略

* 新建 `TolerantStrategyKeys` 类，列举所有支持的容错策略键名
* 新建 `TolerantStrategyFactory` 工厂类，支持根据 key 从 SPI 获取容错策略对象实例
* 编写容错策略接口 SPI 配置文件
* 为 `RpcConfig` 新增容错策略配置

### 应用容错
